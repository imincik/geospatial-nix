# Example Python web application

This is a example web application demonstrating development of Python
application using dependencies provided by multiple sources.

Application data can be generated by local Python server or by
PostgreSQL/PostGIS database backend.

Application is packaged in container image using traditional `Dockerfile`.

## Dependencies

### Provided by Geonix

* shapely

### Provided by Nixpkgs

* matplotlib

### Provided by Poetry

* black
* flask
* isort
* pytest


## Template initialization

```
mkdir my-project
cd my-project

git init

nix flake init --accept-flake-config --template github:imincik/geonix#python-web

nix flake lock
git add *
```


## Usage

### Development (with local data backend)

* Enter development shell

```
nix develop
```

* Install Python virtual environment using Poetry

```
poetry env use $(which python)
poetry install
```

* Launch Python development server

```
poetry run flask --app src/python_app run --reload
```

* Exit development shell

```
exit
```

### Development (with database data backend)

* Launch PostgreSQL database

```
nix develop .#postgresql
```

* Enter development shell (run in new terminal window)

```
nix develop
```

* Launch Python development server

```
BACKEND=db poetry run flask --app src/python_app run --reload
```

* Connect to PostgreSQL DB container (optional)

```
psql
```

* Exit development shell

```
exit
```


### Geonix CLI

* Search for additional packages (run in development shell)

```
geonix search <PACKAGE>
```


## Deployment

* Build and load base container image

```
nix build .#container
docker load < ./result
```

* Build application container image

```
docker build -t python-app:latest .
```

* Run container

```
docker run --rm -p 8000:8000 python-app:latest
```


## Customized packages

See
[Customized packages](https://github.com/imincik/geonix/wiki/Customized-packages)
for instructions how to customize packages.


## More info

* [Zero to Nix](https://zero-to-nix.com/)
